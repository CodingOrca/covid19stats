<div>
  <div class="sticky-top">
    <mat-toolbar color="primary" role="heading">
      <img class="small-icon" src={{currentCountry.flag}}/>
        <div class="toolbar-center">
          <div>{{currentCountry.country}}</div>
        </div> 
        <button mat-icon-button (click)="openGitHub()">
          <mat-icon>info</mat-icon>
        </button>
    </mat-toolbar>

    <mat-tab-group class="mat-elevation-z8" color="accent" (selectedIndexChange)="selectedIndexChange($event)">
      <mat-tab>
        <ng-template mat-tab-label>#</ng-template>
        <ng-template matTabContent>
          <div class="chart" style="margin: 10px;margin-bottom: 0px">
            <div style="display:flex; flex-flow: row wrap;">
              <div class="wrap-item">
                <div class="small">&Sigma; - total cases:</div>
                {{currentCountry.cases}} ({{currentCountry.casesPerMille | number:"1.2-2"}}&permil;)
              </div>
              <div class="wrap-item">
                <div class="small">T - tested persons:</div>
                {{currentCountry.tests}} ({{currentCountry.testsPerMille | number:"1.2-2"}}&permil;)
              </div>
              <div class="wrap-item">
                <div class="small">&Delta; - new cases:</div>
                <b>{{currentCountry.delta}}</b>
                <mat-icon [inline]=true *ngIf="currentCountry.deltaDelta > 0" class="warn">trending_up</mat-icon>
                <mat-icon [inline]=true *ngIf="currentCountry.deltaDelta < 0" class="green">trending_down</mat-icon>
                <mat-icon [inline]=true *ngIf="currentCountry.deltaDelta == 0">trending_flat</mat-icon>
              </div>
              <div class="wrap-item">
                <div class="small with-subscript">R<sub>0</sub> - Reproduction number</div>
                <b>{{currentCountry.reproductionNumber | number:'1.1-1' }}</b>
                <mat-icon [inline]=true *ngIf="currentCountry.reproductionNumberDelta > 0" class="warn">trending_up</mat-icon>
                <mat-icon [inline]=true *ngIf="currentCountry.reproductionNumberDelta < 0" class="green">trending_down</mat-icon>
                <mat-icon [inline]=true *ngIf="currentCountry.reproductionNumberDelta == 0">trending_flat</mat-icon>
              </div>
              <div class="warn wrap-item">
                <div class="small">A - active cases:</div>
                <b>{{currentCountry.active}}</b>
                <mat-icon [inline]=true *ngIf="currentCountry.activeDelta > 0" class="warn">trending_up</mat-icon>
                <mat-icon [inline]=true *ngIf="currentCountry.activeDelta < 0" class="green">trending_down</mat-icon>
                <mat-icon [inline]=true *ngIf="currentCountry.activeDelta == 0">trending_flat</mat-icon>
              </div>
              <div class="green wrap-item">
                <div class="small">R - recovered:</div>
                <b>{{currentCountry.recovered}}</b>
              </div>
              <div class="warn wrap-item">
                <div class="small">C - critical:</div>
                <b>{{currentCountry.critical}}</b>
              </div>
              <div class="wrap-item">
                <div class="small">&Theta; - deaths:</div>
                <b>{{currentCountry.deaths}} ({{currentCountry.deltaDeaths}} new)</b>
              </div>
            </div>
            <mat-divider></mat-divider>
            <div style="display:flex; flex-flow: row wrap;">
              <div class="wrap-item">
                <div class="small"> 
                  <b>&permil;</b> applies to <a href="https://www.worldometers.info/" target="_blank">population</a>
                </div>
                <span class="small"> 
                  R<sub>0</sub> - &empty; of last 5 days
                </span>
              </div>
              <div class="wrap-item">
                <div class="small">&empty; 
                  <a href="https://www.wolframalpha.com/input/?i=annual+deaths" target="_blank">mortality of last years:</a>
                </div>
                {{currentCountry.mortalityRate}}/y ({{currentCountry.mortalityRatePerDay}}/d)
              </div>
            </div>
          </div>
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>&Sigma;</ng-template>
        <ng-template matTabContent>
          <div class="chart">
            <ngx-charts-area-chart-stacked
              [scheme]="colorScheme"
              [legend]="legend"
              [legendPosition]="legendPosition"
              [showXAxisLabel]="showXAxisLabel"
              [xAxis]="xAxis"
              [yAxis]="yAxis"
              [xAxisLabel]="'Total cases: &Sigma;=A+R+&Theta; over time'"
              [yAxisTickFormatting]="yAxisTickFormattingFn"
              [xScaleMin]="xTimeScaleMin"
              [results]="currentCasesSeries"
              [timeline]="timeline"
              (select)="onSelect($event)">
            </ngx-charts-area-chart-stacked>
            <!-- [yAxisLabel]="'&larr; tested persons &rarr;'"
              [showYAxisLabel]="'true'"
            [yScaleMax]="currentCountry.tests" -->
        </div>      
        </ng-template> 
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>&Delta;</ng-template>
        <ng-template matTabContent>
          <div class="chart">
            <ngx-charts-bar-vertical
              [scheme]="colorScheme"
              [legend]="legend"
              [barPadding]=1
              [roundDomains]=true
              [legendPosition]="legendPosition"
              [showXAxisLabel]="showXAxisLabel"
              [showYAxisLabel]="showYAxisLabel"
              [xAxis]="xAxis"
              [yAxis]="yAxis"
              [xAxisLabel]="'New cases per day: &Delta; over time'"
              [yAxisLabel]="gAxisLabel"
              [xAxisTicks]="deltaTimeTicks"
              [xAxisTickFormatting]="dateAxisTickFormattingFn"
              [yAxisTickFormatting]="yAxisTickFormattingFn"
              [results]="currentDeltaSeries"
              (select)="onSelect($event)">
            </ngx-charts-bar-vertical>
          </div>
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label><div style="margin-bottom: -4px;">R<sub>0</sub></div></ng-template>
        <ng-template matTabContent>
          <div class="chart">
            <ngx-charts-line-chart
              [showXAxisLabel]="showXAxisLabel"
              [showYAxisLabel]="showYAxisLabel"
              [xAxis]="xAxis"
              [yAxis]="yAxis"
              [xAxisLabel]="'Reproduction number over time'"
              [yAxisLabel]="dAxisLabel"
              [xScaleMin]="xTimeScaleMin"
              [yScaleMax]="'10'"
              [yAxisTicks]="reproductionTicks"
              [xAxisTickFormatting]="dateAxisTickFormattingFn"
              [results]="currentReproductionSeries"
              [timeline]="timeline"
              (select)="onSelect($event)">
            </ngx-charts-line-chart>
          </div>
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>ln&Sigma;</ng-template>
        <ng-template matTabContent>
          <div class="chart">
            <ngx-charts-line-chart
              [legend]="legend"
              [legendPosition]="legendPosition"
              [showXAxisLabel]="showXAxisLabel"
              [showYAxisLabel]="showYAxisLabel"
              [xAxisTickFormatting]="dateAxisTickFormattingFn"
              [yAxisTickFormatting]="logAxisTickFormattingFn"
              [xAxis]="xAxis"
              [yAxis]="yAxis"
              [yAxisTicks]="yLogTicks"
              [xAxisLabel]="'Total cases (logarithmic): &Sigma; over time'"
              [yAxisLabel]="yLogLabel"
              [xScaleMin]="xTimeScaleMin"
              [yScaleMin]="yLogScaleMin"
              [yScaleMax]="yLogScaleMax"
              [results]="currentLogSeries"
              [timeline]="timeline"
              [tooltipDisabled]=true
              (select)="onSelect($event)">
            </ngx-charts-line-chart>
          </div>
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  </div>
  
  <mat-table [dataSource]="tableData" class="full-width mat-elevation-z8" matSort matSortStart="desc">
    <ng-container matColumnDef="country">
      <mat-footer-cell *matFooterCellDef mat-sort-header start="asc" >Country </mat-footer-cell>
      <mat-cell *matCellDef="let element">
        <img class="small-icon" src={{element.flag}}/> {{element.country}} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="cases">
      <mat-footer-cell *matFooterCellDef mat-sort-header class="align-right-cell"> &Sigma; </mat-footer-cell>>
      <mat-cell *matCellDef="let element" class="align-right-cell"> {{element.cases}}</mat-cell>>
    </ng-container>

    <ng-container matColumnDef="delta">
      <mat-footer-cell *matFooterCellDef mat-sort-header class="align-right-cell"> &Delta; </mat-footer-cell>>
      <mat-cell *matCellDef="let element" class="align-right-cell"> {{element.delta}}</mat-cell>>
    </ng-container>

    <ng-container matColumnDef="active">
      <mat-footer-cell *matFooterCellDef mat-sort-header class="align-right-cell warn"> A </mat-footer-cell>>
      <mat-cell *matCellDef="let element" class="align-right-cell"> {{element.active}}</mat-cell>>
    </ng-container>

    <ng-container matColumnDef="recovered">
      <mat-footer-cell *matFooterCellDef class="align-right-cell green" mat-sort-header> R </mat-footer-cell>>
      <mat-cell *matCellDef="let element" class="align-right-cell"> {{element.recovered}} </mat-cell>>
    </ng-container>

    <ng-container matColumnDef="deaths">
      <mat-footer-cell *matFooterCellDef mat-sort-header class="align-right-cell"> &Theta; </mat-footer-cell>>
      <mat-cell *matCellDef="let element" class="align-right-cell"> {{element.deaths}}</mat-cell>>
    </ng-container>

    <ng-container matColumnDef="critical">
      <mat-footer-cell *matFooterCellDef mat-sort-header class="align-right-cell warn"> C </mat-footer-cell>>
      <mat-cell *matCellDef="let element" class="align-right-cell"> {{element.critical}}</mat-cell>>
    </ng-container>

    <ng-container matColumnDef="infectionRate">
      <mat-footer-cell *matFooterCellDef mat-sort-header class="align-right-cell"> <div style="margin-bottom: -4px;">r<sub>0</sub></div> </mat-footer-cell>>
      <mat-cell *matCellDef="let element" class="align-right-cell"> {{element.infectionRate | number:'1.1-1'}}%</mat-cell>>
    </ng-container>

    <ng-container matColumnDef="reproductionNumber">
      <mat-footer-cell *matFooterCellDef mat-sort-header class="align-right-cell"> <div style="margin-bottom: -4px;">R<sub>0</sub></div> </mat-footer-cell>>
      <mat-cell *matCellDef="let element" class="align-right-cell"> {{element.reproductionNumber | number:'1.2-2'}}</mat-cell>>
    </ng-container>

    <mat-row *matRowDef="let row; columns: displayedColumns" 
      [ngClass]="{'highlight': currentCountry == row}"
      (click)="selectCountry(row)">
    </mat-row>>
    <mat-footer-row *matFooterRowDef="displayedColumns;sticky: true"></mat-footer-row>>

  </mat-table>
</div>

<div style="margin: 15px;">
  <h1>Disclaimer & Credits</h1> 
  <p>This application is work in progress. It is not tested, please do not rely on it.</p>
  <p>Covid-19 data are provided by 
  <a href="https://github.com/NovelCOVID" target="_blank">NovelCOVID</a>.
  </p>
  Mortality rates are taken from 
  <a href="https://www.wolframalpha.com/input/?i=annual+deaths" target="_blank">Wolfram Alpha</a>.
</div>

<router-outlet></router-outlet>
